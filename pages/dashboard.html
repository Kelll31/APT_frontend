<!-- pages/dashboard.html -->
<!-- Advanced Dashboard module for IP Roast Enterprise 4.0 -->
<!-- Enhanced with full functionality from dashboard folder -->

<!-- All Dashboard Styles -->
<link rel="stylesheet" href="../dashboard/dashboard.css">
<link rel="stylesheet" href="../dashboard/overview.css">
<link rel="stylesheet" href="../dashboard/widgets.css">

<!-- Dashboard Header Section -->
<div class="dashboard-header">
    <div class="header-left">
        <div class="title-section">
            <h1 class="dashboard-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
            <div class="version-info">Enterprise 4.0</div>
        </div>

        <div class="system-status" id="system-status-widget">
            <div class="status-indicator status-healthy"></div>
            <div class="status-content">
                <div class="status-text">–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ</div>
                <div class="status-update">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span></div>
            </div>
        </div>
    </div>

    <div class="header-controls">
        <!-- Auto Refresh Toggle -->
        <div class="auto-refresh-toggle">
            <label class="toggle-label">
                <input type="checkbox" id="auto-refresh" checked>
                <span class="toggle-slider"></span>
                <span class="toggle-text">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
            </label>
        </div>

        <!-- Time Range Selector -->
        <div class="time-range-selector">
            <label for="time-range">–ü–µ—Ä–∏–æ–¥:</label>
            <select id="time-range" class="time-range-select">
                <option value="1h">–ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å</option>
                <option value="6h">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 —á–∞—Å–æ–≤</option>
                <option value="24h" selected>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</option>
                <option value="7d">–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è</option>
                <option value="30d">–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
            </select>
        </div>

        <!-- Refresh Button -->
        <button class="refresh-btn" id="refresh-btn" title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ">
            <i class="icon-refresh fas fa-sync-alt"></i>
            <span class="btn-text">–û–±–Ω–æ–≤–∏—Ç—å</span>
        </button>

        <!-- Stale Data Indicator -->
        <div class="stale-indicator hidden" id="stale-indicator" title="–î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
    </div>
</div>

<!-- KPI Overview Section with Enhanced Cards -->
<div id="dashboard-overview" class="dashboard-overview">
    <!-- KPI cards will be dynamically generated by OverviewWidget -->

    <!-- Security Status Card -->
    <div class="kpi-card security-status healthy" id="security-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">–°–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h4>
            <div class="kpi-icon security">
                <i class="fas fa-shield-alt"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="security-score">95</div>
            <div class="kpi-label">–û—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
            <div class="kpi-description">–°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—â–µ–Ω–∞</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend positive">
                <i class="trend-arrow fas fa-arrow-up"></i>
                +5% –∑–∞ –Ω–µ–¥–µ–ª—é
            </div>
            <div class="kpi-period">–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</div>
        </div>
    </div>

    <!-- Network Activity Card -->
    <div class="kpi-card network-status" id="network-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">–°–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h4>
            <div class="kpi-icon network">
                <i class="fas fa-network-wired"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="active-devices">247</div>
            <div class="kpi-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</div>
            <div class="kpi-description">–≤ —Å–µ—Ç–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend neutral">
                <i class="trend-arrow fas fa-minus"></i>
                –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            </div>
            <div class="kpi-period">–∑–∞ —á–∞—Å</div>
        </div>
    </div>

    <!-- Vulnerabilities Card -->
    <div class="kpi-card performance" id="vulns-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">–£—è–∑–≤–∏–º–æ—Å—Ç–∏</h4>
            <div class="kpi-icon performance">
                <i class="fas fa-bug"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="critical-vulns">12</div>
            <div class="kpi-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö</div>
            <div class="kpi-description">—Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend negative">
                <i class="trend-arrow fas fa-arrow-down"></i>
                -3 –∑–∞ –¥–µ–Ω—å
            </div>
            <div class="kpi-period">–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
        </div>
        <div class="performance-progress warning" style="--progress-width: 75%"></div>
    </div>

    <!-- Scan Performance Card -->
    <div class="kpi-card clickable" id="scans-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
            <div class="kpi-icon users">
                <i class="fas fa-search"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="completed-scans">89</div>
            <div class="kpi-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="kpi-description">—Å—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: 4.2 –º–∏–Ω</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend positive">
                <i class="trend-arrow fas fa-arrow-up"></i>
                +12% —Å–∫–æ—Ä–æ—Å—Ç—å
            </div>
            <div class="kpi-period">–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</div>
        </div>
    </div>
</div>

<!-- Enhanced Dashboard Widgets Section -->
<div class="dashboard-widgets">

    <!-- Network Activity Chart Widget -->
    <div id="network-activity-widget" class="widget chart-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-chart-area"></i>
                –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ—Ç–∏
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" data-action="settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="widget-action" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º" data-action="fullscreen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="chart-container">
                <canvas id="network-activity-chart"></canvas>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-primary)"></div>
                        <span>–í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-success)"></div>
                        <span>–ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-warning)"></div>
                        <span>–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Scans List Widget -->
    <div id="recent-scans-widget" class="widget list-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-search"></i>
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="list-container" id="scans-list">
                <!-- Scan items will be dynamically generated -->
            </div>
        </div>
        <div class="widget-footer">
            <button class="btn btn--primary btn--sm" onclick="openScanModal()">
                <i class="fas fa-plus"></i>
                –ù–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            </button>
        </div>
    </div>

    <!-- Devices Status Table Widget -->
    <div id="devices-widget" class="widget table-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-desktop"></i>
                –ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–≠–∫—Å–ø–æ—Ä—Ç" data-action="export">
                    <i class="fas fa-download"></i>
                </button>
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="table-container">
                <table class="data-table" id="devices-table">
                    <thead>
                        <tr>
                            <th>IP –∞–¥—Ä–µ—Å</th>
                            <th>Hostname</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                            <th class="table-cell-action">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="devices-table-body">
                        <!-- Table rows will be dynamically generated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Threat Intelligence Widget -->
    <div id="threat-intel-widget" class="widget stats-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-shield-alt"></i>
                –ê–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–î–µ—Ç–∞–ª–∏" data-action="details">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="stats-grid" id="threat-stats">
                <div class="stat-item">
                    <div class="stat-value" id="blocked-threats">1,247</div>
                    <div class="stat-label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ —É–≥—Ä–æ–∑</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +23%
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="malware-detected">18</div>
                    <div class="stat-label">–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –ü–û</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        -7%
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="intrusion-attempts">3</div>
                    <div class="stat-label">–ü–æ–ø—ã—Ç–æ–∫ –≤—Ç–æ—Ä–∂–µ–Ω–∏—è</div>
                    <div class="stat-change neutral">
                        <i class="fas fa-minus"></i>
                        0%
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="false-positives">12</div>
                    <div class="stat-label">–õ–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-down"></i>
                        -15%
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vulnerabilities Progress Widget -->
    <div id="vulnerabilities-widget" class="widget progress-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-bug"></i>
                –°–æ—Å—Ç–æ—è–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–û—Ç—á–µ—Ç" data-action="report">
                    <i class="fas fa-chart-bar"></i>
                </button>
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="progress-list" id="vulnerability-progress">
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏</div>
                        <div class="progress-value">12 / 24</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill error" style="width: 50%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                        <div class="progress-value">45 / 67</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill warning" style="width: 67%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                        <div class="progress-value">128 / 156</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill success" style="width: 82%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</div>
                        <div class="progress-value">234 / 245</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 95%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Feed Widget -->
    <div id="activity-feed-widget" class="widget notification-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-stream"></i>
                –õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–§–∏–ª—å—Ç—Ä" data-action="filter">
                    <i class="fas fa-filter"></i>
                </button>
                <button class="widget-action" title="–û—á–∏—Å—Ç–∏—Ç—å" data-action="clear">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="notification-list" id="activity-feed">
                <!-- Activity feed items will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Network Topology Preview Widget -->
    <div id="network-topology-widget" class="widget chart-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-project-diagram"></i>
                –¢–æ–ø–æ–ª–æ–≥–∏—è —Å–µ—Ç–∏
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–ü–æ–ª–Ω—ã–π –≤–∏–¥" data-action="fullview">
                    <i class="fas fa-external-link-alt"></i>
                </button>
                <button class="widget-action" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è" data-action="display">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="topology-container" id="topology-preview">
                <!-- Network topology preview will be dynamically generated -->
                <div class="topology-info">
                    <div class="topology-stats">
                        <div class="topology-stat">
                            <span class="stat-number">24</span>
                            <span class="stat-label">–£–∑–ª–æ–≤</span>
                        </div>
                        <div class="topology-stat">
                            <span class="stat-number">47</span>
                            <span class="stat-label">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–π</span>
                        </div>
                        <div class="topology-stat">
                            <span class="stat-number">3</span>
                            <span class="stat-label">–ü–æ–¥—Å–µ—Ç–µ–π</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Performance Widget -->
    <div id="performance-widget" class="widget chart-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-tachometer-alt"></i>
                –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="–û–±–Ω–æ–≤–∏—Ç—å" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="chart-container">
                <canvas id="performance-chart"></canvas>
            </div>
        </div>
    </div>

</div>

<!-- Enhanced Templates for Dynamic Content -->
<script type="text/template" id="scan-item-template">
  <div class="list-item" data-scan-id="{{id}}">
    <div class="list-item-content">
      <i class="list-item-icon {{iconClass}}"></i>
      <div class="list-item-text">
        <div class="list-item-title">{{name}}</div>
        <div class="list-item-subtitle">{{status}}</div>
      </div>
    </div>
    <div class="list-item-meta">
      <div class="list-item-status {{statusClass}}">{{statusText}}</div>
      <div class="list-item-value">{{percentComplete}}%</div>
      <div class="list-item-time">{{timeAgo}}</div>
    </div>
  </div>
</script>

<script type="text/template" id="device-item-template">
  <div class="list-item" data-device-id="{{id}}">
    <div class="list-item-content">
      <i class="list-item-icon {{deviceIcon}}"></i>
      <div class="list-item-text">
        <div class="list-item-title">{{ip}}</div>
        <div class="list-item-subtitle">{{hostname}}</div>
      </div>
    </div>
    <div class="list-item-meta">
      <div class="list-item-status {{statusClass}}">{{status}}</div>
      <div class="list-item-time">{{lastSeen}}</div>
    </div>
  </div>
</script>

<script type="text/template" id="activity-item-template">
  <div class="notification-item {{type}}" data-activity-id="{{id}}">
    <div class="notification-icon">
      <i class="{{iconClass}}"></i>
    </div>
    <div class="notification-content">
      <div class="notification-title">{{title}}</div>
      <div class="notification-message">{{message}}</div>
      <div class="notification-time">{{timestamp}}</div>
    </div>
  </div>
</script>

<script type="text/template" id="device-table-row-template">
  <tr data-device-id="{{id}}">
    <td class="table-cell-mono">{{ip}}</td>
    <td>{{hostname}}</td>
    <td class="table-cell-status">
      <span class="list-item-status {{statusClass}}">{{status}}</span>
    </td>
    <td>{{lastActive}}</td>
    <td class="table-cell-action">
      <button class="table-action primary" onclick="viewDevice('{{id}}')">
        <i class="fas fa-eye"></i>
      </button>
      <button class="table-action secondary" onclick="scanDevice('{{id}}')">
        <i class="fas fa-search"></i>
      </button>
    </td>
  </tr>
</script>

<!-- Enhanced JavaScript Initialization -->
<script src="../dashboard/overview.js" defer></script>
<script src="../dashboard/widgets.js" defer></script>
<script src="../dashboard/dashboard.js" defer></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Enhanced OverviewWidget with full options
        const overviewWidget = new OverviewWidget({
            container: document.getElementById('dashboard-overview'),
            autoUpdate: true,
            updateInterval: 30000,
            showAnimations: true,
            showTrends: true,
            maxChartPoints: 100,
            onStatsUpdate: (stats) => {
                console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:', stats);
                updateKPICards(stats);
            },
            onError: (error) => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –æ–±–∑–æ—Ä–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
            }
        });

        // Initialize Enhanced DashboardController with full capabilities
        const dashboardController = new DashboardController({
            container: '#dashboard-container',
            autoRefresh: true,
            refreshInterval: 30000,
            enableWebSocket: true,
            maxActivityItems: 100,
            chartAnimations: true,
            onDataUpdate: (data) => {
                console.log('üîÑ –î–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', data);
                updateWidgets(data);
            },
            onError: (error) => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–∞—à–±–æ—Ä–¥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞', 'error');
            }
        });

        // Initialize individual widgets from widgets.js
        initializeEnhancedWidgets();

        // Setup event handlers for widget interactions
        setupWidgetEventHandlers();

        // Setup periodic data refresh
        setupAutoRefresh();

        // Initialize charts
        initializeDashboardCharts();

        // Setup keyboard shortcuts
        setupKeyboardShortcuts();
    });

    // Enhanced widget initialization
    function initializeEnhancedWidgets() {
        // Network Activity Chart Widget
        if (window.Chart) {
            initializeNetworkActivityChart();
        }

        // Performance Chart Widget
        initializePerformanceChart();

        // Device List Widget from widgets.js
        const deviceWidget = new DeviceListWidget({
            container: '#devices-widget .widget-body',
            autoUpdate: true,
            updateInterval: 60000
        });

        // Activity Feed Widget
        initializeActivityFeed();

        // Topology Preview Widget
        initializeTopologyPreview();
    }

    // Network Activity Chart initialization
    function initializeNetworkActivityChart() {
        const ctx = document.getElementById('network-activity-chart');
        if (!ctx) return;

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '–í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫',
                    data: [],
                    borderColor: 'var(--color-primary)',
                    backgroundColor: 'rgba(var(--color-primary-rgb), 0.1)',
                    tension: 0.4
                }, {
                    label: '–ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫',
                    data: [],
                    borderColor: 'var(--color-success)',
                    backgroundColor: 'rgba(var(--color-success-rgb), 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false // –ò—Å–ø–æ–ª—å–∑—É–µ–º custom legend
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Performance Chart initialization
    function initializePerformanceChart() {
        const ctx = document.getElementById('performance-chart');
        if (!ctx) return;

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['CPU', '–ü–∞–º—è—Ç—å', '–î–∏—Å–∫', '–°–µ—Ç—å'],
                datasets: [{
                    data: [45, 62, 23, 78],
                    backgroundColor: [
                        'var(--color-primary)',
                        'var(--color-success)',
                        'var(--color-warning)',
                        'var(--color-error)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    // Enhanced event handlers for widget interactions
    function setupWidgetEventHandlers() {
        // Widget action buttons
        document.querySelectorAll('.widget-action').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.closest('.widget-action').dataset.action;
                const widget = e.target.closest('.widget');
                handleWidgetAction(widget, action);
            });
        });

        // Auto refresh toggle
        document.getElementById('auto-refresh')?.addEventListener('change', (e) => {
            if (e.target.checked) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        });

        // Time range selector
        document.getElementById('time-range')?.addEventListener('change', (e) => {
            updateTimeRange(e.target.value);
        });

        // Refresh button
        document.getElementById('refresh-btn')?.addEventListener('click', () => {
            refreshAllData();
        });
    }

    // Widget action handler
    function handleWidgetAction(widget, action) {
        const widgetId = widget.id;
        console.log(`üîß Widget action: ${action} on ${widgetId}`);

        switch (action) {
            case 'refresh':
                refreshWidget(widget);
                break;
            case 'settings':
                openWidgetSettings(widget);
                break;
            case 'fullscreen':
                toggleWidgetFullscreen(widget);
                break;
            case 'export':
                exportWidgetData(widget);
                break;
            case 'filter':
                showWidgetFilter(widget);
                break;
            case 'clear':
                clearWidgetData(widget);
                break;
            case 'fullview':
                openFullView(widget);
                break;
            case 'details':
                showWidgetDetails(widget);
                break;
            case 'report':
                generateWidgetReport(widget);
                break;
            case 'display':
                showDisplaySettings(widget);
                break;
        }
    }

    // Auto refresh functionality
    let refreshInterval;

    function setupAutoRefresh() {
        startAutoRefresh();
    }

    function startAutoRefresh() {
        if (refreshInterval) clearInterval(refreshInterval);

        refreshInterval = setInterval(() => {
            refreshAllData();
        }, 30000); // 30 seconds
    }

    function stopAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
            refreshInterval = null;
        }
    }

    // Data refresh functions
    function refreshAllData() {
        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞');

        // Update timestamp
        document.getElementById('last-update').textContent = new Date().toLocaleTimeString();

        // Refresh all widgets
        document.querySelectorAll('.widget').forEach(widget => {
            refreshWidget(widget);
        });

        // Update KPI cards
        updateKPICards();
    }

    function refreshWidget(widget) {
        const widgetId = widget.id;

        // Add loading state
        widget.classList.add('loading');

        // Simulate data loading
        setTimeout(() => {
            widget.classList.remove('loading');
            console.log(`‚úÖ Widget ${widgetId} –æ–±–Ω–æ–≤–ª–µ–Ω`);
        }, 1000 + Math.random() * 2000);
    }

    // Keyboard shortcuts
    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'r':
                        e.preventDefault();
                        refreshAllData();
                        break;
                    case '1':
                        e.preventDefault();
                        focusWidget('network-activity-widget');
                        break;
                    case '2':
                        e.preventDefault();
                        focusWidget('devices-widget');
                        break;
                    case '3':
                        e.preventDefault();
                        focusWidget('vulnerabilities-widget');
                        break;
                }
            }
        });
    }

    // Utility functions
    function updateKPICards(stats = {}) {
        // Update security score
        const securityScore = stats.securityScore || Math.floor(Math.random() * 100);
        document.getElementById('security-score').textContent = securityScore;

        // Update active devices count
        const activeDevices = stats.activeDevices || Math.floor(Math.random() * 300);
        document.getElementById('active-devices').textContent = activeDevices;

        // Update critical vulnerabilities
        const criticalVulns = stats.criticalVulns || Math.floor(Math.random() * 20);
        document.getElementById('critical-vulns').textContent = criticalVulns;

        // Update completed scans
        const completedScans = stats.completedScans || Math.floor(Math.random() * 100);
        document.getElementById('completed-scans').textContent = completedScans;
    }

    function showNotification(message, type = 'info') {
        console.log(`üì¢ ${type.toUpperCase()}: ${message}`);
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    }

    function focusWidget(widgetId) {
        const widget = document.getElementById(widgetId);
        if (widget) {
            widget.scrollIntoView({ behavior: 'smooth', block: 'center' });
            widget.classList.add('widget--focused');
            setTimeout(() => widget.classList.remove('widget--focused'), 2000);
        }
    }

    // Placeholder functions for widget actions
    function refreshWidget(widget) { /* implemented above */ }
    function openWidgetSettings(widget) { console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∂–µ—Ç–∞'); }
    function toggleWidgetFullscreen(widget) { console.log('–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º'); }
    function exportWidgetData(widget) { console.log('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö'); }
    function showWidgetFilter(widget) { console.log('–§–∏–ª—å—Ç—Ä –≤–∏–¥–∂–µ—Ç–∞'); }
    function clearWidgetData(widget) { console.log('–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö'); }
    function openFullView(widget) { console.log('–ü–æ–ª–Ω—ã–π –≤–∏–¥'); }
    function showWidgetDetails(widget) { console.log('–î–µ—Ç–∞–ª–∏ –≤–∏–¥–∂–µ—Ç–∞'); }
    function generateWidgetReport(widget) { console.log('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞'); }
    function showDisplaySettings(widget) { console.log('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è'); }

    function initializeActivityFeed() { console.log('Activity Feed initialized'); }
    function initializeTopologyPreview() { console.log('Topology Preview initialized'); }
    function updateTimeRange(range) { console.log('Time range updated:', range); }
    function updateWidgets(data) { console.log('Widgets updated with data:', data); }

    // Modal functions
    function openScanModal() { console.log('–û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è'); }
    function viewDevice(id) { console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:', id); }
    function scanDevice(id) { console.log('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:', id); }
</script>

<style>
    /* Additional styles for enhanced functionality */
    .widget--focused {
        transform: scale(1.02);
        box-shadow: 0 8px 25px rgba(var(--color-primary-rgb), 0.3);
        transition: all 0.3s ease;
    }

    .topology-info {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background: rgba(var(--color-secondary-rgb), 0.1);
        border-radius: var(--radius-base);
    }

    .topology-stats {
        display: flex;
        gap: var(--space-24);
        text-align: center;
    }

    .topology-stat {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
    }

    .stat-number {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-primary);
    }

    .stat-label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
    }

    .loading-screen {
        display: none;
    }

    /* Animation for KPI cards */
    @keyframes kpi-update {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.05);
        }

        100% {
            transform: scale(1);
        }
    }

    .kpi-card.updating {
        animation: kpi-update 0.6s ease;
    }
</style>