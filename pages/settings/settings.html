<!-- pages/settings.html -->
<!-- Advanced Settings module for IP Roast Enterprise 4.0 -->
<!-- Enhanced with full functionality from settings folder -->

<!-- All Settings Styles -->
<link rel="stylesheet" href="../settings/settings.css">
<link rel="stylesheet" href="../settings/system-config.css">
<link rel="stylesheet" href="../settings/theme-manager.css">
<link rel="stylesheet" href="../settings/user-preferences.css">

<!-- Settings Container -->
<div class="settings" id="settings-container">

    <!-- Settings Header -->
    <div class="settings__header">
        <div class="settings-header-content">
            <div class="settings-title-section">
                <h1 class="settings-main-title">
                    <i class="fas fa-cog"></i>
                    Настройки системы
                </h1>
                <p class="settings-subtitle">Управление конфигурацией IP Roast Enterprise 4.0</p>
            </div>

            <div class="settings-header-actions">
                <button class="settings-action-btn" id="import-settings" title="Импорт настроек">
                    <i class="fas fa-upload"></i>
                    <span>Импорт</span>
                </button>
                <button class="settings-action-btn" id="export-settings" title="Экспорт настроек">
                    <i class="fas fa-download"></i>
                    <span>Экспорт</span>
                </button>
                <button class="settings-action-btn" id="reset-settings" title="Сброс к заводским">
                    <i class="fas fa-undo-alt"></i>
                    <span>Сброс</span>
                </button>
            </div>
        </div>

        <!-- Settings Navigation Tabs -->
        <div class="settings__tabs">
            <button class="settings__tab settings__tab--active" data-tab="system">
                <i class="fas fa-server"></i>
                Система
            </button>
            <button class="settings__tab" data-tab="user">
                <i class="fas fa-user"></i>
                Пользователь
            </button>
            <button class="settings__tab" data-tab="themes">
                <i class="fas fa-palette"></i>
                Темы
            </button>
            <button class="settings__tab" data-tab="security">
                <i class="fas fa-shield-alt"></i>
                Безопасность
            </button>
            <button class="settings__tab" data-tab="integrations">
                <i class="fas fa-puzzle-piece"></i>
                Интеграции
            </button>
            <button class="settings__tab" data-tab="advanced">
                <i class="fas fa-tools"></i>
                Дополнительно
            </button>
        </div>
    </div>

    <!-- Settings Content -->
    <div class="settings__content">

        <!-- System Configuration Tab -->
        <div class="settings-tab-content active" id="system-tab">
            <div class="system-config" id="system-config-container">
                <div class="system-config__header">
                    <i class="fas fa-server"></i>
                    Системная конфигурация
                </div>
                <div class="system-config__body">
                    <!-- Network Settings -->
                    <div class="settings__section">
                        <h3 class="settings__section-title">Сетевые настройки</h3>

                        <div class="settings__row">
                            <label class="settings__label" for="api-host">API сервер:</label>
                            <input type="text" class="settings__input" id="api-host" value="localhost:8080">
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="websocket-url">WebSocket URL:</label>
                            <input type="text" class="settings__input" id="websocket-url"
                                value="ws://localhost:8080/ws">
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="timeout">Таймаут запросов (сек):</label>
                            <input type="number" class="settings__input" id="timeout" value="30" min="5" max="300">
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="max-retries">Максимум повторов:</label>
                            <input type="number" class="settings__input" id="max-retries" value="3" min="1" max="10">
                        </div>
                    </div>

                    <!-- Performance Settings -->
                    <div class="settings__section">
                        <h3 class="settings__section-title">Производительность</h3>

                        <div class="settings__row">
                            <label class="settings__label" for="max-concurrent">Максимум параллельных сканов:</label>
                            <input type="number" class="settings__input" id="max-concurrent" value="5" min="1" max="20">
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="cache-ttl">TTL кеша (мин):</label>
                            <input type="number" class="settings__input" id="cache-ttl" value="15" min="1" max="1440">
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="auto-refresh">Автообновление данных:</label>
                            <div class="settings__toggle">
                                <input type="checkbox" class="settings__toggle-input" id="auto-refresh" checked>
                                <span class="settings__toggle-slider"></span>
                            </div>
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="refresh-interval">Интервал обновления (сек):</label>
                            <select class="settings__select" id="refresh-interval">
                                <option value="10">10 секунд</option>
                                <option value="30" selected>30 секунд</option>
                                <option value="60">1 минута</option>
                                <option value="300">5 минут</option>
                            </select>
                        </div>
                    </div>

                    <!-- Logging Settings -->
                    <div class="settings__section">
                        <h3 class="settings__section-title">Журналирование</h3>

                        <div class="settings__row">
                            <label class="settings__label" for="log-level">Уровень журналирования:</label>
                            <select class="settings__select" id="log-level">
                                <option value="ERROR">Только ошибки</option>
                                <option value="WARN">Предупреждения</option>
                                <option value="INFO" selected>Информационные</option>
                                <option value="DEBUG">Отладочные</option>
                            </select>
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="enable-console-logs">Логи в консоль:</label>
                            <div class="settings__toggle">
                                <input type="checkbox" class="settings__toggle-input" id="enable-console-logs" checked>
                                <span class="settings__toggle-slider"></span>
                            </div>
                        </div>

                        <div class="settings__row">
                            <label class="settings__label" for="max-log-entries">Максимум записей в памяти:</label>
                            <input type="number" class="settings__input" id="max-log-entries" value="1000" min="100"
                                max="10000">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Preferences Tab -->
        <div class="settings-tab-content" id="user-tab">
            <div class="user-preferences" id="user-preferences-container">
                <div class="user-preferences__header">
                    <i class="fas fa-user"></i>
                    Пользовательские предпочтения
                </div>
                <form class="user-preferences__form" id="user-preferences-form">
                    <!-- Profile Information -->
                    <div class="settings__section">
                        <h3 class="settings__section-title">Профиль пользователя</h3>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="user-name">Имя пользователя:</label>
                            <div class="user-preferences__control">
                                <input type="text" class="settings__input" id="user-name" value="Администратор">
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="user-email">Email:</label>
                            <div class="user-preferences__control">
                                <input type="email" class="settings__input" id="user-email" value="admin@company.local">
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="user-role">Роль:</label>
                            <div class="user-preferences__control">
                                <select class="user-preferences__select" id="user-role">
                                    <option value="admin" selected>Администратор</option>
                                    <option value="operator">Оператор</option>
                                    <option value="viewer">Наблюдатель</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Interface Preferences -->
                    <div class="settings__section">
                        <h3 class="settings__section-title">Предпочтения интерфейса</h3>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="language">Язык интерфейса:</label>
                            <div class="user-preferences__control">
                                <select class="user-preferences__select" id="language">
                                    <option value="ru" selected>Русский</option>
                                    <option value="en">English</option>
                                    <option value="de">Deutsch</option>
                                    <option value="fr">Français</option>
                                </select>
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="items-per-page">Элементов на страницу:</label>
                            <div class="user-preferences__control">
                                <select class="user-preferences__select" id="items-per-page">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="default-view">Режим просмотра по
                                умолчанию:</label>
                            <div class="user-preferences__control">
                                <select class="user-preferences__select" id="default-view">
                                    <option value="grid" selected>Сетка</option>
                                    <option value="list">Список</option>
                                    <option value="table">Таблица</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div class="settings__section">
                        <h3 class="settings__section-title">Уведомления</h3>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="enable-notifications">Включить
                                уведомления:</label>
                            <div class="user-preferences__control">
                                <input type="checkbox" class="user-preferences__checkbox" id="enable-notifications"
                                    checked>
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="notification-sound">Звуковые
                                уведомления:</label>
                            <div class="user-preferences__control">
                                <input type="checkbox" class="user-preferences__checkbox" id="notification-sound">
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="notification-position">Позиция
                                уведомлений:</label>
                            <div class="user-preferences__control">
                                <select class="user-preferences__select" id="notification-position">
                                    <option value="top-right" selected>Вверху справа</option>
                                    <option value="top-left">Вверху слева</option>
                                    <option value="bottom-right">Внизу справа</option>
                                    <option value="bottom-left">Внизу слева</option>
                                </select>
                            </div>
                        </div>

                        <div class="user-preferences__row">
                            <label class="user-preferences__label" for="notification-timeout">Время показа
                                (сек):</label>
                            <div class="user-preferences__control">
                                <div class="user-preferences__slider">
                                    <input type="range" class="user-preferences__slider-input" id="notification-timeout"
                                        min="3" max="10" value="5">
                                    <span class="slider-value" id="notification-timeout-value">5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Theme Manager Tab -->
        <div class="settings-tab-content" id="themes-tab">
            <div class="theme-manager" id="theme-manager-container">
                <div class="theme-manager__header">
                    <i class="fas fa-palette"></i>
                    Управление темами
                </div>

                <!-- Theme Selection -->
                <div class="settings__section">
                    <h3 class="settings__section-title">Выбор темы</h3>

                    <ul class="theme-manager__list">
                        <li class="theme-manager__item">
                            <label class="theme-manager__label">
                                <input type="radio" class="theme-manager__radio" name="theme" value="light"
                                    id="theme-light">
                                <span class="theme-manager__name">Светлая тема</span>
                            </label>
                            <div class="theme-preview theme-preview--light">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-sidebar"></div>
                                    <div class="preview-main"></div>
                                </div>
                            </div>
                        </li>

                        <li class="theme-manager__item">
                            <label class="theme-manager__label">
                                <input type="radio" class="theme-manager__radio" name="theme" value="dark"
                                    id="theme-dark" checked>
                                <span class="theme-manager__name">Темная тема</span>
                            </label>
                            <div class="theme-preview theme-preview--dark">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-sidebar"></div>
                                    <div class="preview-main"></div>
                                </div>
                            </div>
                        </li>

                        <li class="theme-manager__item">
                            <label class="theme-manager__label">
                                <input type="radio" class="theme-manager__radio" name="theme" value="cyberpunk"
                                    id="theme-cyberpunk">
                                <span class="theme-manager__name">Киберпанк тема</span>
                            </label>
                            <div class="theme-preview theme-preview--cyberpunk">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-sidebar"></div>
                                    <div class="preview-main"></div>
                                </div>
                            </div>
                        </li>

                        <li class="theme-manager__item">
                            <label class="theme-manager__label">
                                <input type="radio" class="theme-manager__radio" name="theme" value="auto"
                                    id="theme-auto">
                                <span class="theme-manager__name">Автоматическая (системная)</span>
                            </label>
                            <div class="theme-preview theme-preview--auto">
                                <div class="preview-header"></div>
                                <div class="preview-content">
                                    <div class="preview-sidebar"></div>
                                    <div class="preview-main"></div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Theme Customization -->
                <div class="settings__section">
                    <h3 class="settings__section-title">Настройка темы</h3>

                    <div class="theme-customization">
                        <div class="custom-colors">
                            <div class="color-group">
                                <h4>Основные цвета</h4>
                                <div class="color-inputs">
                                    <div class="color-input-group">
                                        <label>Основной цвет:</label>
                                        <input type="color" class="color-input" id="primary-color" value="#32b8c6">
                                    </div>
                                    <div class="color-input-group">
                                        <label>Вторичный цвет:</label>
                                        <input type="color" class="color-input" id="secondary-color" value="#5e5e52">
                                    </div>
                                    <div class="color-input-group">
                                        <label>Цвет успеха:</label>
                                        <input type="color" class="color-input" id="success-color" value="#32b8c6">
                                    </div>
                                    <div class="color-input-group">
                                        <label>Цвет ошибки:</label>
                                        <input type="color" class="color-input" id="error-color" value="#c0152f">
                                    </div>
                                </div>
                            </div>

                            <div class="color-group">
                                <h4>Расширенные настройки</h4>
                                <div class="settings__row">
                                    <label class="settings__label" for="border-radius">Скругление углов:</label>
                                    <div class="user-preferences__slider">
                                        <input type="range" class="user-preferences__slider-input" id="border-radius"
                                            min="0" max="16" value="8">
                                        <span class="slider-value" id="border-radius-value">8px</span>
                                    </div>
                                </div>

                                <div class="settings__row">
                                    <label class="settings__label" for="font-size">Размер шрифта:</label>
                                    <select class="settings__select" id="font-size">
                                        <option value="12">Маленький (12px)</option>
                                        <option value="14" selected>Обычный (14px)</option>
                                        <option value="16">Большой (16px)</option>
                                        <option value="18">Очень большой (18px)</option>
                                    </select>
                                </div>

                                <div class="settings__row">
                                    <label class="settings__label" for="animation-speed">Скорость анимаций:</label>
                                    <select class="settings__select" id="animation-speed">
                                        <option value="0">Отключены</option>
                                        <option value="0.1">Очень быстро</option>
                                        <option value="0.25" selected>Быстро</option>
                                        <option value="0.5">Обычно</option>
                                        <option value="1">Медленно</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Tab -->
        <div class="settings-tab-content" id="security-tab">
            <div class="security-settings">
                <div class="settings__section">
                    <h3 class="settings__section-title">Аутентификация и авторизация</h3>

                    <div class="settings__row">
                        <label class="settings__label" for="session-timeout">Время сессии (мин):</label>
                        <input type="number" class="settings__input" id="session-timeout" value="480" min="15"
                            max="1440">
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="auto-lock">Автоблокировка при бездействии:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="auto-lock" checked>
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="lock-timeout">Время до блокировки (мин):</label>
                        <input type="number" class="settings__input" id="lock-timeout" value="30" min="5" max="120">
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="require-password">Требовать пароль для критичных
                            операций:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="require-password" checked>
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>
                </div>

                <div class="settings__section">
                    <h3 class="settings__section-title">Конфиденциальность данных</h3>

                    <div class="settings__row">
                        <label class="settings__label" for="encrypt-local-data">Шифровать локальные данные:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="encrypt-local-data" checked>
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="clear-cache">Очищать кеш при выходе:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="clear-cache">
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="audit-logging">Журналирование действий пользователя:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="audit-logging" checked>
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>
                </div>

                <div class="settings__section">
                    <h3 class="settings__section-title">Сетевая безопасность</h3>

                    <div class="settings__row">
                        <label class="settings__label" for="ssl-only">Только HTTPS соединения:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="ssl-only" checked>
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="validate-certificates">Проверять SSL сертификаты:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="validate-certificates" checked>
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="allowed-hosts">Разрешенные хосты:</label>
                        <textarea class="settings__input" id="allowed-hosts" rows="3">localhost
192.168.1.*
*.company.local</textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integrations Tab -->
        <div class="settings-tab-content" id="integrations-tab">
            <div class="integrations-settings">
                <div class="settings__section">
                    <h3 class="settings__section-title">Внешние сервисы</h3>

                    <!-- SIEM Integration -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-info">
                                <h4>SIEM система</h4>
                                <p>Интеграция с системой управления информационной безопасностью</p>
                            </div>
                            <div class="integration-status">
                                <div class="settings__toggle">
                                    <input type="checkbox" class="settings__toggle-input" id="siem-integration">
                                    <span class="settings__toggle-slider"></span>
                                </div>
                            </div>
                        </div>
                        <div class="integration-config">
                            <div class="settings__row">
                                <label class="settings__label" for="siem-url">URL SIEM системы:</label>
                                <input type="text" class="settings__input" id="siem-url"
                                    placeholder="https://siem.company.local">
                            </div>
                            <div class="settings__row">
                                <label class="settings__label" for="siem-api-key">API ключ:</label>
                                <input type="password" class="settings__input" id="siem-api-key"
                                    placeholder="Введите API ключ">
                            </div>
                        </div>
                    </div>

                    <!-- Vulnerability Database -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-info">
                                <h4>База уязвимостей CVE</h4>
                                <p>Автоматическое обновление информации об уязвимостях</p>
                            </div>
                            <div class="integration-status">
                                <div class="settings__toggle">
                                    <input type="checkbox" class="settings__toggle-input" id="cve-integration" checked>
                                    <span class="settings__toggle-slider"></span>
                                </div>
                            </div>
                        </div>
                        <div class="integration-config">
                            <div class="settings__row">
                                <label class="settings__label" for="cve-update-interval">Интервал обновления:</label>
                                <select class="settings__select" id="cve-update-interval">
                                    <option value="1">Ежедневно</option>
                                    <option value="7" selected>Еженедельно</option>
                                    <option value="30">Ежемесячно</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Email Notifications -->
                    <div class="integration-card">
                        <div class="integration-header">
                            <div class="integration-info">
                                <h4>Email уведомления</h4>
                                <p>Отправка отчетов и уведомлений по электронной почте</p>
                            </div>
                            <div class="integration-status">
                                <div class="settings__toggle">
                                    <input type="checkbox" class="settings__toggle-input" id="email-integration">
                                    <span class="settings__toggle-slider"></span>
                                </div>
                            </div>
                        </div>
                        <div class="integration-config">
                            <div class="settings__row">
                                <label class="settings__label" for="smtp-server">SMTP сервер:</label>
                                <input type="text" class="settings__input" id="smtp-server"
                                    placeholder="smtp.company.local">
                            </div>
                            <div class="settings__row">
                                <label class="settings__label" for="smtp-port">Порт:</label>
                                <input type="number" class="settings__input" id="smtp-port" value="587" min="1"
                                    max="65535">
                            </div>
                            <div class="settings__row">
                                <label class="settings__label" for="smtp-username">Имя пользователя:</label>
                                <input type="text" class="settings__input" id="smtp-username"
                                    placeholder="notifications@company.local">
                            </div>
                            <div class="settings__row">
                                <label class="settings__label" for="smtp-password">Пароль:</label>
                                <input type="password" class="settings__input" id="smtp-password"
                                    placeholder="Введите пароль">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Tab -->
        <div class="settings-tab-content" id="advanced-tab">
            <div class="advanced-settings">
                <div class="settings__section">
                    <h3 class="settings__section-title">Экспериментальные функции</h3>

                    <div class="settings__row">
                        <label class="settings__label" for="enable-beta">Включить бета-функции:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="enable-beta">
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="developer-mode">Режим разработчика:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="developer-mode">
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>

                    <div class="settings__row">
                        <label class="settings__label" for="debug-mode">Отладочный режим:</label>
                        <div class="settings__toggle">
                            <input type="checkbox" class="settings__toggle-input" id="debug-mode">
                            <span class="settings__toggle-slider"></span>
                        </div>
                    </div>
                </div>

                <div class="settings__section">
                    <h3 class="settings__section-title">Очистка данных</h3>

                    <div class="cleanup-actions">
                        <div class="cleanup-item">
                            <div class="cleanup-info">
                                <h4>Кеш браузера</h4>
                                <p>Очистить временные файлы и кеш приложения</p>
                            </div>
                            <button class="btn btn--secondary btn--sm" onclick="clearBrowserCache()">
                                <i class="fas fa-trash"></i>
                                Очистить
                            </button>
                        </div>

                        <div class="cleanup-item">
                            <div class="cleanup-info">
                                <h4>Локальное хранилище</h4>
                                <p>Удалить все сохраненные настройки и данные</p>
                            </div>
                            <button class="btn btn--secondary btn--sm" onclick="clearLocalStorage()">
                                <i class="fas fa-database"></i>
                                Очистить
                            </button>
                        </div>

                        <div class="cleanup-item">
                            <div class="cleanup-info">
                                <h4>Журналы событий</h4>
                                <p>Удалить локальные журналы событий и ошибок</p>
                            </div>
                            <button class="btn btn--secondary btn--sm" onclick="clearLogs()">
                                <i class="fas fa-file-alt"></i>
                                Очистить
                            </button>
                        </div>

                        <div class="cleanup-item danger">
                            <div class="cleanup-info">
                                <h4>Полный сброс</h4>
                                <p>Сбросить все настройки к заводским значениям</p>
                            </div>
                            <button class="btn btn--outline btn--sm" onclick="confirmFullReset()"
                                style="border-color: var(--color-error); color: var(--color-error);">
                                <i class="fas fa-exclamation-triangle"></i>
                                Сбросить все
                            </button>
                        </div>
                    </div>
                </div>

                <div class="settings__section">
                    <h3 class="settings__section-title">Диагностика</h3>

                    <div class="diagnostic-info">
                        <div class="diagnostic-row">
                            <span class="diagnostic-label">Версия приложения:</span>
                            <span class="diagnostic-value">IP Roast Enterprise 4.0.0</span>
                        </div>
                        <div class="diagnostic-row">
                            <span class="diagnostic-label">Версия API:</span>
                            <span class="diagnostic-value" id="api-version">Загрузка...</span>
                        </div>
                        <div class="diagnostic-row">
                            <span class="diagnostic-label">Браузер:</span>
                            <span class="diagnostic-value" id="browser-info">Загрузка...</span>
                        </div>
                        <div class="diagnostic-row">
                            <span class="diagnostic-label">Статус подключения:</span>
                            <span class="diagnostic-value status--success" id="connection-status">Подключено</span>
                        </div>
                        <div class="diagnostic-row">
                            <span class="diagnostic-label">Последнее обновление:</span>
                            <span class="diagnostic-value" id="last-update">Только что</span>
                        </div>
                    </div>

                    <div class="diagnostic-actions">
                        <button class="btn btn--secondary btn--sm" onclick="runDiagnostics()">
                            <i class="fas fa-stethoscope"></i>
                            Запустить диагностику
                        </button>
                        <button class="btn btn--secondary btn--sm" onclick="downloadLogs()">
                            <i class="fas fa-download"></i>
                            Скачать журналы
                        </button>
                        <button class="btn btn--secondary btn--sm" onclick="checkUpdates()">
                            <i class="fas fa-sync-alt"></i>
                            Проверить обновления
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Actions Footer -->
    <div class="settings__actions">
        <button class="settings__btn settings__btn--cancel" id="cancel-changes">
            <i class="fas fa-times"></i>
            Отменить
        </button>
        <button class="settings__btn settings__btn--save" id="save-settings">
            <i class="fas fa-save"></i>
            Сохранить изменения
        </button>
    </div>
</div>

<!-- Enhanced JavaScript Initialization -->
<script src="../settings/system-config.js" defer></script>
<script src="../settings/theme-manager.js" defer></script>
<script src="../settings/user-preferences.js" defer></script>
<script src="../settings/settings.js" defer></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        console.log('⚙️ Initializing Enhanced Settings Module');

        // Initialize main settings controller
        const settingsController = new SettingsController('#settings-container');

        // Setup tab switching
        setupTabNavigation();

        // Setup form handlers
        setupFormHandlers();

        // Setup theme management
        setupThemeManagement();

        // Setup range sliders
        setupRangeSliders();

        // Setup integration toggles
        setupIntegrationToggles();

        // Load current settings
        loadCurrentSettings();

        // Setup keyboard shortcuts
        setupKeyboardShortcuts();

        // Setup real-time updates
        setupRealTimeUpdates();

        // Setup diagnostic info
        loadDiagnosticInfo();
    });

    // Tab navigation setup
    function setupTabNavigation() {
        const tabs = document.querySelectorAll('.settings__tab');
        const tabContents = document.querySelectorAll('.settings-tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                const targetTab = e.target.closest('.settings__tab').dataset.tab;

                // Update active tab
                tabs.forEach(t => t.classList.remove('settings__tab--active'));
                e.target.closest('.settings__tab').classList.add('settings__tab--active');

                // Show corresponding content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${targetTab}-tab`) {
                        content.classList.add('active');
                    }
                });

                console.log(`📑 Switched to ${targetTab} tab`);
            });
        });
    }

    // Form handlers setup
    function setupFormHandlers() {
        // Save settings
        document.getElementById('save-settings').addEventListener('click', saveAllSettings);

        // Cancel changes
        document.getElementById('cancel-changes').addEventListener('click', cancelChanges);

        // Import/Export settings
        document.getElementById('import-settings').addEventListener('click', importSettings);
        document.getElementById('export-settings').addEventListener('click', exportSettings);
        document.getElementById('reset-settings').addEventListener('click', resetToDefaults);

        // Auto-save on input change (debounced)
        let saveTimeout;
        document.querySelectorAll('input, select, textarea').forEach(input => {
            input.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    autoSaveSettings();
                }, 1000); // 1 second delay
            });
        });
    }

    // Theme management setup
    function setupThemeManagement() {
        const themeRadios = document.querySelectorAll('input[name="theme"]');

        themeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.checked) {
                    applyTheme(e.target.value);
                }
            });
        });

        // Color inputs
        document.querySelectorAll('.color-input').forEach(input => {
            input.addEventListener('input', (e) => {
                updateCustomColors();
            });
        });

        // Load current theme
        const currentTheme = localStorage.getItem('ipRoast:theme') || 'dark';
        document.getElementById(`theme-${currentTheme}`)?.checked = true;
    }

    // Range sliders setup
    function setupRangeSliders() {
        document.querySelectorAll('.user-preferences__slider-input').forEach(slider => {
            const valueDisplay = document.getElementById(slider.id + '-value');

            slider.addEventListener('input', (e) => {
                let value = e.target.value;
                let suffix = '';

                if (slider.id === 'border-radius') {
                    suffix = 'px';
                } else if (slider.id === 'notification-timeout') {
                    suffix = ' сек';
                }

                valueDisplay.textContent = value + suffix;
            });

            // Initial update
            slider.dispatchEvent(new Event('input'));
        });
    }

    // Integration toggles setup
    function setupIntegrationToggles() {
        document.querySelectorAll('.integration-card .settings__toggle-input').forEach(toggle => {
            toggle.addEventListener('change', (e) => {
                const card = e.target.closest('.integration-card');
                const config = card.querySelector('.integration-config');

                if (e.target.checked) {
                    config.style.display = 'block';
                } else {
                    config.style.display = 'none';
                }
            });

            // Initial state
            toggle.dispatchEvent(new Event('change'));
        });
    }

    // Load current settings
    function loadCurrentSettings() {
        console.log('📥 Loading current settings');

        // System settings
        const systemSettings = JSON.parse(localStorage.getItem('ipRoast:systemSettings') || '{}');

        Object.keys(systemSettings).forEach(key => {
            const input = document.getElementById(key);
            if (input) {
                if (input.type === 'checkbox') {
                    input.checked = systemSettings[key];
                } else {
                    input.value = systemSettings[key];
                }
            }
        });

        // User preferences
        const userPrefs = JSON.parse(localStorage.getItem('ipRoast:userPreferences') || '{}');

        Object.keys(userPrefs).forEach(key => {
            const input = document.getElementById(key);
            if (input) {
                if (input.type === 'checkbox') {
                    input.checked = userPrefs[key];
                } else {
                    input.value = userPrefs[key];
                }
            }
        });
    }

    // Save all settings
    function saveAllSettings() {
        console.log('💾 Saving all settings');

        const systemSettings = {};
        const userPreferences = {};
        const securitySettings = {};

        // Collect system settings
        document.querySelectorAll('#system-tab input, #system-tab select').forEach(input => {
            if (input.type === 'checkbox') {
                systemSettings[input.id] = input.checked;
            } else {
                systemSettings[input.id] = input.value;
            }
        });

        // Collect user preferences
        document.querySelectorAll('#user-tab input, #user-tab select').forEach(input => {
            if (input.type === 'checkbox') {
                userPreferences[input.id] = input.checked;
            } else {
                userPreferences[input.id] = input.value;
            }
        });

        // Collect security settings
        document.querySelectorAll('#security-tab input, #security-tab select, #security-tab textarea').forEach(input => {
            if (input.type === 'checkbox') {
                securitySettings[input.id] = input.checked;
            } else {
                securitySettings[input.id] = input.value;
            }
        });

        // Save to localStorage
        localStorage.setItem('ipRoast:systemSettings', JSON.stringify(systemSettings));
        localStorage.setItem('ipRoast:userPreferences', JSON.stringify(userPreferences));
        localStorage.setItem('ipRoast:securitySettings', JSON.stringify(securitySettings));

        showNotification('Настройки сохранены успешно', 'success');
    }

    // Auto-save settings
    function autoSaveSettings() {
        console.log('🔄 Auto-saving settings');
        saveAllSettings();
    }

    // Apply theme
    function applyTheme(themeName) {
        console.log('🎨 Applying theme:', themeName);

        document.documentElement.setAttribute('data-theme', themeName);
        localStorage.setItem('ipRoast:theme', themeName);

        showNotification(`Тема "${themeName}" применена`, 'success');
    }

    // Update custom colors
    function updateCustomColors() {
        console.log('🌈 Updating custom colors');

        const primaryColor = document.getElementById('primary-color').value;
        const secondaryColor = document.getElementById('secondary-color').value;
        const successColor = document.getElementById('success-color').value;
        const errorColor = document.getElementById('error-color').value;

        document.documentElement.style.setProperty('--color-primary', primaryColor);
        document.documentElement.style.setProperty('--color-secondary', secondaryColor);
        document.documentElement.style.setProperty('--color-success', successColor);
        document.documentElement.style.setProperty('--color-error', errorColor);
    }

    // Load diagnostic information
    function loadDiagnosticInfo() {
        // Browser info
        const browserInfo = navigator.userAgent.split(' ').slice(-2).join(' ');
        document.getElementById('browser-info').textContent = browserInfo;

        // Connection status check
        setInterval(() => {
            const status = navigator.onLine ? 'Подключено' : 'Отключено';
            const statusClass = navigator.onLine ? 'status--success' : 'status--error';

            const statusElement = document.getElementById('connection-status');
            statusElement.textContent = status;
            statusElement.className = `diagnostic-value ${statusClass}`;
        }, 5000);

        // Last update time
        setInterval(() => {
            document.getElementById('last-update').textContent = new Date().toLocaleString();
        }, 30000);

        // API version (simulate API call)
        setTimeout(() => {
            document.getElementById('api-version').textContent = 'v4.0.0-enterprise';
        }, 1000);
    }

    // Keyboard shortcuts
    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveAllSettings();
                        break;
                    case 'z':
                        e.preventDefault();
                        if (e.shiftKey) {
                            // Redo
                            console.log('Redo action');
                        } else {
                            // Undo
                            console.log('Undo action');
                        }
                        break;
                    case ',':
                        e.preventDefault();
                        // Already in settings, focus on first tab
                        document.querySelector('.settings__tab').focus();
                        break;
                }
            }

            // Tab switching with Alt + Number
            if (e.altKey && e.key >= '1' && e.key <= '6') {
                e.preventDefault();
                const tabIndex = parseInt(e.key) - 1;
                const tabs = document.querySelectorAll('.settings__tab');
                if (tabs[tabIndex]) {
                    tabs[tabIndex].click();
                }
            }
        });
    }

    // Real-time updates setup
    function setupRealTimeUpdates() {
        // Monitor system resources (simulated)
        setInterval(() => {
            updateSystemStatus();
        }, 10000); // 10 seconds
    }

    // Utility functions
    function updateSystemStatus() {
        // Simulate system status updates
        const connectionStatus = document.getElementById('connection-status');
        if (connectionStatus) {
            connectionStatus.textContent = navigator.onLine ? 'Подключено' : 'Отключено';
            connectionStatus.className = navigator.onLine ? 'diagnostic-value status--success' : 'diagnostic-value status--error';
        }
    }

    function showNotification(message, type = 'info') {
        console.log(`📢 ${type.toUpperCase()}: ${message}`);

        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
        <div class="notification-icon">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i>
        </div>
        <div class="notification-content">
            <div class="notification-message">${message}</div>
            <div class="notification-time">${new Date().toLocaleTimeString()}</div>
        </div>
        <button class="notification-close">
            <i class="fas fa-times"></i>
        </button>
    `;

        // Add to container
        let container = document.querySelector('.notification-container');
        if (!container) {
            container = document.createElement('div');
            container.className = 'notification-container';
            document.body.appendChild(container);
        }

        container.appendChild(notification);

        // Show animation
        setTimeout(() => notification.classList.add('notification-show'), 100);

        // Auto hide
        setTimeout(() => {
            notification.classList.add('notification-hide');
            setTimeout(() => notification.remove(), 300);
        }, 5000);

        // Close button
        notification.querySelector('.notification-close').addEventListener('click', () => {
            notification.classList.add('notification-hide');
            setTimeout(() => notification.remove(), 300);
        });
    }

    // Action functions
    function importSettings() { console.log('📂 Import settings'); }
    function exportSettings() { console.log('📤 Export settings'); }
    function resetToDefaults() { console.log('🔄 Reset to defaults'); }
    function cancelChanges() { console.log('❌ Cancel changes'); }

    // Cleanup functions
    function clearBrowserCache() {
        console.log('🗑️ Clear browser cache');
        showNotification('Кеш браузера очищен', 'success');
    }

    function clearLocalStorage() {
        console.log('🗑️ Clear local storage');
        localStorage.clear();
        showNotification('Локальное хранилище очищено', 'success');
    }

    function clearLogs() {
        console.log('🗑️ Clear logs');
        showNotification('Журналы очищены', 'success');
    }

    function confirmFullReset() {
        if (confirm('Вы уверены, что хотите сбросить все настройки? Это действие нельзя отменить.')) {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }
    }

    // Diagnostic functions
    function runDiagnostics() {
        console.log('🔍 Running diagnostics');
        showNotification('Диагностика запущена', 'info');

        setTimeout(() => {
            showNotification('Диагностика завершена. Проблем не найдено.', 'success');
        }, 3000);
    }

    function downloadLogs() {
        console.log('📥 Download logs');
        showNotification('Журналы подготавливаются для скачивания', 'info');
    }

    function checkUpdates() {
        console.log('🔄 Check updates');
        showNotification('Проверка обновлений...', 'info');

        setTimeout(() => {
            showNotification('Вы используете последнюю версию', 'success');
        }, 2000);
    }
</script>

<style>
    /* Enhanced Settings Styles */
    .settings {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: var(--color-background);
    }

    .settings-header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: var(--space-24);
        background: var(--color-surface);
        border-bottom: 1px solid var(--color-card-border);
    }

    .settings-title-section h1 {
        display: flex;
        align-items: center;
        gap: var(--space-12);
        color: var(--color-text);
        margin: 0 0 var(--space-8) 0;
    }

    .settings-title-section h1 i {
        color: var(--color-primary);
    }

    .settings-subtitle {
        color: var(--color-text-secondary);
        margin: 0;
        font-size: var(--font-size-base);
    }

    .settings-header-actions {
        display: flex;
        gap: var(--space-12);
    }

    .settings-action-btn {
        display: flex;
        align-items: center;
        gap: var(--space-6);
        padding: var(--space-8) var(--space-16);
        background: transparent;
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        color: var(--color-text-secondary);
        cursor: pointer;
        transition: all var(--duration-fast) var(--ease-standard);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
    }

    .settings-action-btn:hover {
        background: var(--color-secondary);
        color: var(--color-text);
        border-color: var(--color-primary);
    }

    .settings-tab-content {
        display: none;
        padding: var(--space-24);
        flex: 1;
        overflow-y: auto;
    }

    .settings-tab-content.active {
        display: block;
    }

    /* Theme Previews */
    .theme-preview {
        width: 60px;
        height: 40px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--color-border);
        overflow: hidden;
        margin-left: var(--space-12);
        display: flex;
        flex-direction: column;
    }

    .theme-preview--light {
        background: #fcfcf9;
    }

    .theme-preview--light .preview-header {
        height: 12px;
        background: #fffffd;
        border-bottom: 1px solid rgba(94, 82, 64, 0.12);
    }

    .theme-preview--light .preview-content {
        flex: 1;
        display: flex;
    }

    .theme-preview--light .preview-sidebar {
        width: 20px;
        background: #fffffd;
        border-right: 1px solid rgba(94, 82, 64, 0.12);
    }

    .theme-preview--light .preview-main {
        flex: 1;
        background: #fcfcf9;
    }

    .theme-preview--dark {
        background: var(--color-charcoal-700);
    }

    .theme-preview--dark .preview-header {
        height: 12px;
        background: var(--color-charcoal-800);
        border-bottom: 1px solid rgba(119, 124, 124, 0.2);
    }

    .theme-preview--dark .preview-content {
        flex: 1;
        display: flex;
    }

    .theme-preview--dark .preview-sidebar {
        width: 20px;
        background: var(--color-charcoal-800);
        border-right: 1px solid rgba(119, 124, 124, 0.2);
    }

    .theme-preview--dark .preview-main {
        flex: 1;
        background: var(--color-charcoal-700);
    }

    .theme-preview--cyberpunk {
        background: #0f0f0f;
    }

    .theme-preview--cyberpunk .preview-header {
        height: 12px;
        background: #080808;
        border-bottom: 1px solid #9333ea;
    }

    .theme-preview--cyberpunk .preview-content {
        flex: 1;
        display: flex;
    }

    .theme-preview--cyberpunk .preview-sidebar {
        width: 20px;
        background: #080808;
        border-right: 1px solid #06b6d4;
    }

    .theme-preview--cyberpunk .preview-main {
        flex: 1;
        background: #0f0f0f;
    }

    .theme-preview--auto {
        background: linear-gradient(45deg, #fcfcf9 0%, #fcfcf9 50%, var(--color-charcoal-700) 50%, var(--color-charcoal-700) 100%);
    }

    .theme-preview--auto .preview-header {
        height: 12px;
        background: linear-gradient(45deg, #fffffd 0%, #fffffd 50%, var(--color-charcoal-800) 50%, var(--color-charcoal-800) 100%);
    }

    .theme-preview--auto .preview-content {
        flex: 1;
        display: flex;
    }

    .theme-preview--auto .preview-sidebar {
        width: 20px;
        background: linear-gradient(45deg, #fffffd 0%, #fffffd 50%, var(--color-charcoal-800) 50%, var(--color-charcoal-800) 100%);
    }

    .theme-preview--auto .preview-main {
        flex: 1;
        background: linear-gradient(45deg, #fcfcf9 0%, #fcfcf9 50%, var(--color-charcoal-700) 50%, var(--color-charcoal-700) 100%);
    }

    /* Color Inputs */
    .color-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-16);
    }

    .color-input-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
    }

    .color-input-group label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
        font-weight: var(--font-weight-medium);
    }

    .color-input {
        width: 100%;
        height: 40px;
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        cursor: pointer;
    }

    /* Integration Cards */
    .integration-card {
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-16);
        overflow: hidden;
        background: var(--color-surface);
    }

    .integration-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-16);
        background: var(--color-secondary);
    }

    .integration-info h4 {
        margin: 0 0 var(--space-4) 0;
        color: var(--color-text);
    }

    .integration-info p {
        margin: 0;
        color: var(--color-text-secondary);
        font-size: var(--font-size-sm);
    }

    .integration-config {
        padding: var(--space-16);
        border-top: 1px solid var(--color-border);
        display: none;
    }

    /* Cleanup Actions */
    .cleanup-actions {
        display: flex;
        flex-direction: column;
        gap: var(--space-16);
    }

    .cleanup-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-16);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        background: var(--color-surface);
    }

    .cleanup-item.danger {
        border-color: var(--color-error);
        background: rgba(var(--color-error-rgb), 0.05);
    }

    .cleanup-info h4 {
        margin: 0 0 var(--space-4) 0;
        color: var(--color-text);
    }

    .cleanup-info p {
        margin: 0;
        color: var(--color-text-secondary);
        font-size: var(--font-size-sm);
    }

    /* Diagnostic Info */
    .diagnostic-info {
        display: flex;
        flex-direction: column;
        gap: var(--space-8);
        margin-bottom: var(--space-24);
    }

    .diagnostic-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-8) 0;
        border-bottom: 1px solid var(--color-border);
    }

    .diagnostic-label {
        font-weight: var(--font-weight-medium);
        color: var(--color-text);
    }

    .diagnostic-value {
        color: var(--color-text-secondary);
        font-family: var(--font-family-mono);
        font-size: var(--font-size-sm);
    }

    .diagnostic-actions {
        display: flex;
        gap: var(--space-12);
        flex-wrap: wrap;
    }

    /* Slider styling */
    .user-preferences__slider {
        display: flex;
        align-items: center;
        gap: var(--space-12);
        width: 100%;
    }

    .user-preferences__slider-input {
        flex: 1;
    }

    .slider-value {
        min-width: 60px;
        text-align: right;
        font-family: var(--font-family-mono);
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .settings-header-content {
            flex-direction: column;
            gap: var(--space-16);
            align-items: stretch;
        }

        .settings-header-actions {
            justify-content: space-between;
        }

        .settings__tabs {
            overflow-x: auto;
            flex-wrap: nowrap;
        }

        .settings__tab {
            white-space: nowrap;
        }

        .color-inputs {
            grid-template-columns: 1fr;
        }

        .cleanup-item {
            flex-direction: column;
            gap: var(--space-12);
            align-items: stretch;
        }

        .diagnostic-actions {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .settings-tab-content {
            padding: var(--space-16);
        }

        .integration-header {
            flex-direction: column;
            gap: var(--space-12);
            align-items: stretch;
        }

        .diagnostic-row {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-4);
        }
    }
</style>