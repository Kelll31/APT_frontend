<!-- pages/dashboard.html -->
<!-- Advanced Dashboard module for IP Roast Enterprise 4.0 -->
<!-- Enhanced with full functionality from dashboard folder -->

<!-- All Dashboard Styles -->
<link rel="stylesheet" href="../dashboard/dashboard.css">
<link rel="stylesheet" href="../dashboard/overview.css">
<link rel="stylesheet" href="../dashboard/widgets.css">

<!-- Dashboard Header Section -->
<div class="dashboard-header">
    <div class="header-left">
        <div class="title-section">
            <h1 class="dashboard-title">Панель управления</h1>
            <div class="version-info">Enterprise 4.0</div>
        </div>

        <div class="system-status" id="system-status-widget">
            <div class="status-indicator status-healthy"></div>
            <div class="status-content">
                <div class="status-text">Система работает нормально</div>
                <div class="status-update">Обновлено: <span id="last-update">только что</span></div>
            </div>
        </div>
    </div>

    <div class="header-controls">
        <!-- Auto Refresh Toggle -->
        <div class="auto-refresh-toggle">
            <label class="toggle-label">
                <input type="checkbox" id="auto-refresh" checked>
                <span class="toggle-slider"></span>
                <span class="toggle-text">Автообновление</span>
            </label>
        </div>

        <!-- Time Range Selector -->
        <div class="time-range-selector">
            <label for="time-range">Период:</label>
            <select id="time-range" class="time-range-select">
                <option value="1h">Последний час</option>
                <option value="6h">Последние 6 часов</option>
                <option value="24h" selected>Последние 24 часа</option>
                <option value="7d">Последняя неделя</option>
                <option value="30d">Последний месяц</option>
            </select>
        </div>

        <!-- Refresh Button -->
        <button class="refresh-btn" id="refresh-btn" title="Обновить данные">
            <i class="icon-refresh fas fa-sync-alt"></i>
            <span class="btn-text">Обновить</span>
        </button>

        <!-- Stale Data Indicator -->
        <div class="stale-indicator hidden" id="stale-indicator" title="Данные устарели">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
    </div>
</div>

<!-- KPI Overview Section with Enhanced Cards -->
<div id="dashboard-overview" class="dashboard-overview">
    <!-- KPI cards will be dynamically generated by OverviewWidget -->

    <!-- Security Status Card -->
    <div class="kpi-card security-status healthy" id="security-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">Состояние безопасности</h4>
            <div class="kpi-icon security">
                <i class="fas fa-shield-alt"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="security-score">95</div>
            <div class="kpi-label">Оценка безопасности</div>
            <div class="kpi-description">Система защищена</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend positive">
                <i class="trend-arrow fas fa-arrow-up"></i>
                +5% за неделю
            </div>
            <div class="kpi-period">последние 7 дней</div>
        </div>
    </div>

    <!-- Network Activity Card -->
    <div class="kpi-card network-status" id="network-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">Сетевая активность</h4>
            <div class="kpi-icon network">
                <i class="fas fa-network-wired"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="active-devices">247</div>
            <div class="kpi-label">Активных устройств</div>
            <div class="kpi-description">в сети обнаружено</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend neutral">
                <i class="trend-arrow fas fa-minus"></i>
                Без изменений
            </div>
            <div class="kpi-period">за час</div>
        </div>
    </div>

    <!-- Vulnerabilities Card -->
    <div class="kpi-card performance" id="vulns-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">Уязвимости</h4>
            <div class="kpi-icon performance">
                <i class="fas fa-bug"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="critical-vulns">12</div>
            <div class="kpi-label">Критических</div>
            <div class="kpi-description">требуют внимания</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend negative">
                <i class="trend-arrow fas fa-arrow-down"></i>
                -3 за день
            </div>
            <div class="kpi-period">исправлено</div>
        </div>
        <div class="performance-progress warning" style="--progress-width: 75%"></div>
    </div>

    <!-- Scan Performance Card -->
    <div class="kpi-card clickable" id="scans-kpi">
        <div class="kpi-header">
            <h4 class="kpi-title">Сканирования</h4>
            <div class="kpi-icon users">
                <i class="fas fa-search"></i>
            </div>
        </div>
        <div class="kpi-content">
            <div class="kpi-value" id="completed-scans">89</div>
            <div class="kpi-label">Завершено сегодня</div>
            <div class="kpi-description">средняя скорость: 4.2 мин</div>
        </div>
        <div class="kpi-footer">
            <div class="kpi-trend positive">
                <i class="trend-arrow fas fa-arrow-up"></i>
                +12% скорость
            </div>
            <div class="kpi-period">оптимизация</div>
        </div>
    </div>
</div>

<!-- Enhanced Dashboard Widgets Section -->
<div class="dashboard-widgets">

    <!-- Network Activity Chart Widget -->
    <div id="network-activity-widget" class="widget chart-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-chart-area"></i>
                Активность сети
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Настройки" data-action="settings">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="widget-action" title="Полноэкранный режим" data-action="fullscreen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="chart-container">
                <canvas id="network-activity-chart"></canvas>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-primary)"></div>
                        <span>Входящий трафик</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-success)"></div>
                        <span>Исходящий трафик</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-warning)"></div>
                        <span>Подозрительная активность</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Scans List Widget -->
    <div id="recent-scans-widget" class="widget list-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-search"></i>
                Последние сканирования
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="list-container" id="scans-list">
                <!-- Scan items will be dynamically generated -->
            </div>
        </div>
        <div class="widget-footer">
            <button class="btn btn--primary btn--sm" onclick="openScanModal()">
                <i class="fas fa-plus"></i>
                Новое сканирование
            </button>
        </div>
    </div>

    <!-- Devices Status Table Widget -->
    <div id="devices-widget" class="widget table-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-desktop"></i>
                Активные устройства
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Экспорт" data-action="export">
                    <i class="fas fa-download"></i>
                </button>
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="table-container">
                <table class="data-table" id="devices-table">
                    <thead>
                        <tr>
                            <th>IP адрес</th>
                            <th>Hostname</th>
                            <th>Статус</th>
                            <th>Последняя активность</th>
                            <th class="table-cell-action">Действия</th>
                        </tr>
                    </thead>
                    <tbody id="devices-table-body">
                        <!-- Table rows will be dynamically generated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Threat Intelligence Widget -->
    <div id="threat-intel-widget" class="widget stats-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-shield-alt"></i>
                Анализ угроз
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Детали" data-action="details">
                    <i class="fas fa-info-circle"></i>
                </button>
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="stats-grid" id="threat-stats">
                <div class="stat-item">
                    <div class="stat-value" id="blocked-threats">1,247</div>
                    <div class="stat-label">Заблокировано угроз</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +23%
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="malware-detected">18</div>
                    <div class="stat-label">Обнаружено вредоносного ПО</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        -7%
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="intrusion-attempts">3</div>
                    <div class="stat-label">Попыток вторжения</div>
                    <div class="stat-change neutral">
                        <i class="fas fa-minus"></i>
                        0%
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="false-positives">12</div>
                    <div class="stat-label">Ложных срабатываний</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-down"></i>
                        -15%
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vulnerabilities Progress Widget -->
    <div id="vulnerabilities-widget" class="widget progress-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-bug"></i>
                Состояние уязвимостей
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Отчет" data-action="report">
                    <i class="fas fa-chart-bar"></i>
                </button>
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="progress-list" id="vulnerability-progress">
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">Критические уязвимости</div>
                        <div class="progress-value">12 / 24</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill error" style="width: 50%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">Высокий приоритет</div>
                        <div class="progress-value">45 / 67</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill warning" style="width: 67%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">Средний приоритет</div>
                        <div class="progress-value">128 / 156</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill success" style="width: 82%"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-header">
                        <div class="progress-label">Низкий приоритет</div>
                        <div class="progress-value">234 / 245</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 95%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Feed Widget -->
    <div id="activity-feed-widget" class="widget notification-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-stream"></i>
                Лента активности
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Фильтр" data-action="filter">
                    <i class="fas fa-filter"></i>
                </button>
                <button class="widget-action" title="Очистить" data-action="clear">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="notification-list" id="activity-feed">
                <!-- Activity feed items will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Network Topology Preview Widget -->
    <div id="network-topology-widget" class="widget chart-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-project-diagram"></i>
                Топология сети
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Полный вид" data-action="fullview">
                    <i class="fas fa-external-link-alt"></i>
                </button>
                <button class="widget-action" title="Настройки отображения" data-action="display">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="topology-container" id="topology-preview">
                <!-- Network topology preview will be dynamically generated -->
                <div class="topology-info">
                    <div class="topology-stats">
                        <div class="topology-stat">
                            <span class="stat-number">24</span>
                            <span class="stat-label">Узлов</span>
                        </div>
                        <div class="topology-stat">
                            <span class="stat-number">47</span>
                            <span class="stat-label">Соединений</span>
                        </div>
                        <div class="topology-stat">
                            <span class="stat-number">3</span>
                            <span class="stat-label">Подсетей</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Performance Widget -->
    <div id="performance-widget" class="widget chart-widget">
        <div class="widget-header">
            <h3 class="widget-title">
                <i class="widget-icon fas fa-tachometer-alt"></i>
                Производительность системы
            </h3>
            <div class="widget-actions">
                <button class="widget-action" title="Обновить" data-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="widget-body">
            <div class="chart-container">
                <canvas id="performance-chart"></canvas>
            </div>
        </div>
    </div>

</div>

<!-- Enhanced Templates for Dynamic Content -->
<script type="text/template" id="scan-item-template">
  <div class="list-item" data-scan-id="{{id}}">
    <div class="list-item-content">
      <i class="list-item-icon {{iconClass}}"></i>
      <div class="list-item-text">
        <div class="list-item-title">{{name}}</div>
        <div class="list-item-subtitle">{{status}}</div>
      </div>
    </div>
    <div class="list-item-meta">
      <div class="list-item-status {{statusClass}}">{{statusText}}</div>
      <div class="list-item-value">{{percentComplete}}%</div>
      <div class="list-item-time">{{timeAgo}}</div>
    </div>
  </div>
</script>

<script type="text/template" id="device-item-template">
  <div class="list-item" data-device-id="{{id}}">
    <div class="list-item-content">
      <i class="list-item-icon {{deviceIcon}}"></i>
      <div class="list-item-text">
        <div class="list-item-title">{{ip}}</div>
        <div class="list-item-subtitle">{{hostname}}</div>
      </div>
    </div>
    <div class="list-item-meta">
      <div class="list-item-status {{statusClass}}">{{status}}</div>
      <div class="list-item-time">{{lastSeen}}</div>
    </div>
  </div>
</script>

<script type="text/template" id="activity-item-template">
  <div class="notification-item {{type}}" data-activity-id="{{id}}">
    <div class="notification-icon">
      <i class="{{iconClass}}"></i>
    </div>
    <div class="notification-content">
      <div class="notification-title">{{title}}</div>
      <div class="notification-message">{{message}}</div>
      <div class="notification-time">{{timestamp}}</div>
    </div>
  </div>
</script>

<script type="text/template" id="device-table-row-template">
  <tr data-device-id="{{id}}">
    <td class="table-cell-mono">{{ip}}</td>
    <td>{{hostname}}</td>
    <td class="table-cell-status">
      <span class="list-item-status {{statusClass}}">{{status}}</span>
    </td>
    <td>{{lastActive}}</td>
    <td class="table-cell-action">
      <button class="table-action primary" onclick="viewDevice('{{id}}')">
        <i class="fas fa-eye"></i>
      </button>
      <button class="table-action secondary" onclick="scanDevice('{{id}}')">
        <i class="fas fa-search"></i>
      </button>
    </td>
  </tr>
</script>

<!-- Enhanced JavaScript Initialization -->
<script src="../dashboard/overview.js" defer></script>
<script src="../dashboard/widgets.js" defer></script>
<script src="../dashboard/dashboard.js" defer></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Enhanced OverviewWidget with full options
        const overviewWidget = new OverviewWidget({
            container: document.getElementById('dashboard-overview'),
            autoUpdate: true,
            updateInterval: 30000,
            showAnimations: true,
            showTrends: true,
            maxChartPoints: 100,
            onStatsUpdate: (stats) => {
                console.log('📊 Статистика обновлена:', stats);
                updateKPICards(stats);
            },
            onError: (error) => {
                console.error('❌ Ошибка виджета обзора:', error);
                showNotification('Ошибка загрузки статистики', 'error');
            }
        });

        // Initialize Enhanced DashboardController with full capabilities
        const dashboardController = new DashboardController({
            container: '#dashboard-container',
            autoRefresh: true,
            refreshInterval: 30000,
            enableWebSocket: true,
            maxActivityItems: 100,
            chartAnimations: true,
            onDataUpdate: (data) => {
                console.log('🔄 Данные дашборда обновлены:', data);
                updateWidgets(data);
            },
            onError: (error) => {
                console.error('❌ Ошибка контроллера дашборда:', error);
                showNotification('Ошибка загрузки дашборда', 'error');
            }
        });

        // Initialize individual widgets from widgets.js
        initializeEnhancedWidgets();

        // Setup event handlers for widget interactions
        setupWidgetEventHandlers();

        // Setup periodic data refresh
        setupAutoRefresh();

        // Initialize charts
        initializeDashboardCharts();

        // Setup keyboard shortcuts
        setupKeyboardShortcuts();
    });

    // Enhanced widget initialization
    function initializeEnhancedWidgets() {
        // Network Activity Chart Widget
        if (window.Chart) {
            initializeNetworkActivityChart();
        }

        // Performance Chart Widget
        initializePerformanceChart();

        // Device List Widget from widgets.js
        const deviceWidget = new DeviceListWidget({
            container: '#devices-widget .widget-body',
            autoUpdate: true,
            updateInterval: 60000
        });

        // Activity Feed Widget
        initializeActivityFeed();

        // Topology Preview Widget
        initializeTopologyPreview();
    }

    // Network Activity Chart initialization
    function initializeNetworkActivityChart() {
        const ctx = document.getElementById('network-activity-chart');
        if (!ctx) return;

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Входящий трафик',
                    data: [],
                    borderColor: 'var(--color-primary)',
                    backgroundColor: 'rgba(var(--color-primary-rgb), 0.1)',
                    tension: 0.4
                }, {
                    label: 'Исходящий трафик',
                    data: [],
                    borderColor: 'var(--color-success)',
                    backgroundColor: 'rgba(var(--color-success-rgb), 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false // Используем custom legend
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Performance Chart initialization
    function initializePerformanceChart() {
        const ctx = document.getElementById('performance-chart');
        if (!ctx) return;

        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['CPU', 'Память', 'Диск', 'Сеть'],
                datasets: [{
                    data: [45, 62, 23, 78],
                    backgroundColor: [
                        'var(--color-primary)',
                        'var(--color-success)',
                        'var(--color-warning)',
                        'var(--color-error)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }

    // Enhanced event handlers for widget interactions
    function setupWidgetEventHandlers() {
        // Widget action buttons
        document.querySelectorAll('.widget-action').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.target.closest('.widget-action').dataset.action;
                const widget = e.target.closest('.widget');
                handleWidgetAction(widget, action);
            });
        });

        // Auto refresh toggle
        document.getElementById('auto-refresh')?.addEventListener('change', (e) => {
            if (e.target.checked) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        });

        // Time range selector
        document.getElementById('time-range')?.addEventListener('change', (e) => {
            updateTimeRange(e.target.value);
        });

        // Refresh button
        document.getElementById('refresh-btn')?.addEventListener('click', () => {
            refreshAllData();
        });
    }

    // Widget action handler
    function handleWidgetAction(widget, action) {
        const widgetId = widget.id;
        console.log(`🔧 Widget action: ${action} on ${widgetId}`);

        switch (action) {
            case 'refresh':
                refreshWidget(widget);
                break;
            case 'settings':
                openWidgetSettings(widget);
                break;
            case 'fullscreen':
                toggleWidgetFullscreen(widget);
                break;
            case 'export':
                exportWidgetData(widget);
                break;
            case 'filter':
                showWidgetFilter(widget);
                break;
            case 'clear':
                clearWidgetData(widget);
                break;
            case 'fullview':
                openFullView(widget);
                break;
            case 'details':
                showWidgetDetails(widget);
                break;
            case 'report':
                generateWidgetReport(widget);
                break;
            case 'display':
                showDisplaySettings(widget);
                break;
        }
    }

    // Auto refresh functionality
    let refreshInterval;

    function setupAutoRefresh() {
        startAutoRefresh();
    }

    function startAutoRefresh() {
        if (refreshInterval) clearInterval(refreshInterval);

        refreshInterval = setInterval(() => {
            refreshAllData();
        }, 30000); // 30 seconds
    }

    function stopAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
            refreshInterval = null;
        }
    }

    // Data refresh functions
    function refreshAllData() {
        console.log('🔄 Обновление всех данных дашборда');

        // Update timestamp
        document.getElementById('last-update').textContent = new Date().toLocaleTimeString();

        // Refresh all widgets
        document.querySelectorAll('.widget').forEach(widget => {
            refreshWidget(widget);
        });

        // Update KPI cards
        updateKPICards();
    }

    function refreshWidget(widget) {
        const widgetId = widget.id;

        // Add loading state
        widget.classList.add('loading');

        // Simulate data loading
        setTimeout(() => {
            widget.classList.remove('loading');
            console.log(`✅ Widget ${widgetId} обновлен`);
        }, 1000 + Math.random() * 2000);
    }

    // Keyboard shortcuts
    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'r':
                        e.preventDefault();
                        refreshAllData();
                        break;
                    case '1':
                        e.preventDefault();
                        focusWidget('network-activity-widget');
                        break;
                    case '2':
                        e.preventDefault();
                        focusWidget('devices-widget');
                        break;
                    case '3':
                        e.preventDefault();
                        focusWidget('vulnerabilities-widget');
                        break;
                }
            }
        });
    }

    // Utility functions
    function updateKPICards(stats = {}) {
        // Update security score
        const securityScore = stats.securityScore || Math.floor(Math.random() * 100);
        document.getElementById('security-score').textContent = securityScore;

        // Update active devices count
        const activeDevices = stats.activeDevices || Math.floor(Math.random() * 300);
        document.getElementById('active-devices').textContent = activeDevices;

        // Update critical vulnerabilities
        const criticalVulns = stats.criticalVulns || Math.floor(Math.random() * 20);
        document.getElementById('critical-vulns').textContent = criticalVulns;

        // Update completed scans
        const completedScans = stats.completedScans || Math.floor(Math.random() * 100);
        document.getElementById('completed-scans').textContent = completedScans;
    }

    function showNotification(message, type = 'info') {
        console.log(`📢 ${type.toUpperCase()}: ${message}`);
        // Здесь можно добавить реальную систему уведомлений
    }

    function focusWidget(widgetId) {
        const widget = document.getElementById(widgetId);
        if (widget) {
            widget.scrollIntoView({ behavior: 'smooth', block: 'center' });
            widget.classList.add('widget--focused');
            setTimeout(() => widget.classList.remove('widget--focused'), 2000);
        }
    }

    // Placeholder functions for widget actions
    function refreshWidget(widget) { /* implemented above */ }
    function openWidgetSettings(widget) { console.log('Настройки виджета'); }
    function toggleWidgetFullscreen(widget) { console.log('Полноэкранный режим'); }
    function exportWidgetData(widget) { console.log('Экспорт данных'); }
    function showWidgetFilter(widget) { console.log('Фильтр виджета'); }
    function clearWidgetData(widget) { console.log('Очистка данных'); }
    function openFullView(widget) { console.log('Полный вид'); }
    function showWidgetDetails(widget) { console.log('Детали виджета'); }
    function generateWidgetReport(widget) { console.log('Генерация отчета'); }
    function showDisplaySettings(widget) { console.log('Настройки отображения'); }

    function initializeActivityFeed() { console.log('Activity Feed initialized'); }
    function initializeTopologyPreview() { console.log('Topology Preview initialized'); }
    function updateTimeRange(range) { console.log('Time range updated:', range); }
    function updateWidgets(data) { console.log('Widgets updated with data:', data); }

    // Modal functions
    function openScanModal() { console.log('Открытие модального окна сканирования'); }
    function viewDevice(id) { console.log('Просмотр устройства:', id); }
    function scanDevice(id) { console.log('Сканирование устройства:', id); }
</script>

<style>
    /* Additional styles for enhanced functionality */
    .widget--focused {
        transform: scale(1.02);
        box-shadow: 0 8px 25px rgba(var(--color-primary-rgb), 0.3);
        transition: all 0.3s ease;
    }

    .topology-info {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background: rgba(var(--color-secondary-rgb), 0.1);
        border-radius: var(--radius-base);
    }

    .topology-stats {
        display: flex;
        gap: var(--space-24);
        text-align: center;
    }

    .topology-stat {
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
    }

    .stat-number {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-bold);
        color: var(--color-primary);
    }

    .stat-label {
        font-size: var(--font-size-sm);
        color: var(--color-text-secondary);
    }

    .loading-screen {
        display: none;
    }

    /* Animation for KPI cards */
    @keyframes kpi-update {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.05);
        }

        100% {
            transform: scale(1);
        }
    }

    .kpi-card.updating {
        animation: kpi-update 0.6s ease;
    }
</style>